

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  

  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

  <link rel="stylesheet" href="/assets/css/just-the-docs-default.css">

  

  
    <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script>
  
  <script type="text/javascript" src="/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Queestudiar SQS PDF | Documentación Queestudiar</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Queestudiar SQS PDF" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<link rel="canonical" href="http://localhost:4000/Queestudiar%20SQS%20PDF/" />
<meta property="og:url" content="http://localhost:4000/Queestudiar%20SQS%20PDF/" />
<meta property="og:site_name" content="Documentación Queestudiar" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Queestudiar SQS PDF" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","headline":"Queestudiar SQS PDF","url":"http://localhost:4000/Queestudiar%20SQS%20PDF/"}</script>
<!-- End Jekyll SEO tag -->


  

</head>

<body>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="svg-link" viewBox="0 0 24 24">
      <title>Link</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
      </svg>
    </symbol>
    <symbol id="svg-search" viewBox="0 0 24 24">
      <title>Search</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
        <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
    </symbol>
    <symbol id="svg-menu" viewBox="0 0 24 24">
      <title>Menu</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
        <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </symbol>
    <symbol id="svg-arrow-right" viewBox="0 0 24 24">
      <title>Expand</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </symbol>
    <symbol id="svg-doc" viewBox="0 0 24 24">
      <title>Document</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
      </svg>
    </symbol>
  </svg>

  <div class="side-bar">
    <div class="site-header">
      <a href="http://localhost:4000/" class="site-title lh-tight">
  Documentación Queestudiar

</a>
      <a href="#" id="menu-button" class="site-button">
        <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg>
      </a>
    </div>
    <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav">
      
        <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/Features/" class="nav-list-link">Features</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/Manual%20del%20usuario/" class="nav-list-link">Manual del usuario</a><ul class="nav-list"><li class="nav-list-item ">
                    <a href="http://localhost:4000/Dashboard%20de%20colegio/" class="nav-list-link">Dashboard de colegio</a>
                  </li><li class="nav-list-item ">
                    <a href="http://localhost:4000/Dashboard%20de%20estudiante/" class="nav-list-link">Dashboard de estudiante</a>
                  </li><li class="nav-list-item ">
                    <a href="http://localhost:4000/Dashboard%20de%20universidad/" class="nav-list-link">Dashboard de universidad</a>
                  </li><li class="nav-list-item ">
                    <a href="http://localhost:4000/MU%20Test%20Express/" class="nav-list-link">Test Express</a>
                  </li><li class="nav-list-item ">
                    <a href="http://localhost:4000/MU%20Plataforma%20Talento/" class="nav-list-link">Plataforma Talento</a>
                  </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/Documentaci%C3%B3n%20funcional/" class="nav-list-link">Documentación funcional</a><ul class="nav-list"><li class="nav-list-item ">
                    <a href="http://localhost:4000/Query%20SQL/" class="nav-list-link">Query SQL</a>
                  </li></ul></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/Developer/" class="nav-list-link">Developer</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/Arquitectura/" class="nav-list-link">Arquitectura</a><ul class="nav-list"><li class="nav-list-item ">
                    <a href="http://localhost:4000/Queestudiar%20BD/" class="nav-list-link">Queestudiar BD</a>
                  </li><li class="nav-list-item ">
                    <a href="http://localhost:4000/Artefactos/" class="nav-list-link">Artefactos</a>
                  </li><li class="nav-list-item ">
                    <a href="http://localhost:4000/Detalles%20de%20arquitectura/" class="nav-list-link">Detalles de arquitectura</a>
                  </li><li class="nav-list-item ">
                    <a href="http://localhost:4000/Queestudiar%20AWS/" class="nav-list-link">Queestudiar AWS</a>
                  </li></ul></li><li class="nav-list-item  active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/Microservicios/" class="nav-list-link">Microservicios</a><ul class="nav-list"><li class="nav-list-item ">
                    <a href="http://localhost:4000/Queestudiar%20Api/" class="nav-list-link">Queestudiar Api</a>
                  </li><li class="nav-list-item ">
                    <a href="http://localhost:4000/Queestudiar%20Pdf/" class="nav-list-link">Queestudiar Pdf</a>
                  </li><li class="nav-list-item ">
                    <a href="http://localhost:4000/Queestudiar%20Predicci%C3%B3n/" class="nav-list-link">Queestudiar Predicción</a>
                  </li><li class="nav-list-item  active">
                    <a href="http://localhost:4000/Queestudiar%20SQS%20PDF/" class="nav-list-link active">Queestudiar SQS PDF</a>
                  </li><li class="nav-list-item ">
                    <a href="http://localhost:4000/Queestudiar%20M%C3%A9tricas/" class="nav-list-link">Queestudiar Métricas</a>
                  </li><li class="nav-list-item ">
                    <a href="http://localhost:4000/Queestudiar%20Notificaciones/" class="nav-list-link">Queestudiar Notificaciones</a>
                  </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/Webs/" class="nav-list-link">Webs</a><ul class="nav-list"><li class="nav-list-item ">
                    <a href="http://localhost:4000/Usil%20Web/" class="nav-list-link">Usil Web</a>
                  </li><li class="nav-list-item ">
                    <a href="http://localhost:4000/Estudiante%20Web/" class="nav-list-link">Estudiante Web</a>
                  </li><li class="nav-list-item ">
                    <a href="http://localhost:4000/Colegio%20Web/" class="nav-list-link">Colegio Web</a>
                  </li><li class="nav-list-item ">
                    <a href="http://localhost:4000/Test%20Express/" class="nav-list-link">Test Express</a>
                  </li><li class="nav-list-item ">
                    <a href="http://localhost:4000/DEV%20Plataforma%20Talento/" class="nav-list-link">Plataforma Talento</a>
                  </li></ul></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/about/" class="nav-list-link">About</a></li></ul>

      
    </nav>
    <footer class="site-footer">
      This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.
    </footer>
  </div>
  <div class="main" id="top">
    <div id="main-header" class="main-header">
      
        <div class="search">
          <div class="search-input-wrap">
            <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Documentación Queestudiar" aria-label="Search Documentación Queestudiar" autocomplete="off">
            <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
          </div>
          <div id="search-results" class="search-results"></div>
        </div>
      
      
      
    </div>
    <div id="main-content-wrap" class="main-content-wrap">
      
        <nav aria-label="Breadcrumb" class="breadcrumb-nav">
            <ol class="breadcrumb-nav-list">
              
                <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/Developer/">Developer</a></li>
                <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/Microservicios/">Microservicios</a></li>
              
              <li class="breadcrumb-nav-list-item"><span>Queestudiar SQS PDF</span></li>
            </ol>
          </nav>
        
      
      <div id="main-content" class="main-content" role="main">
        
          <details open="">
  <summary class="text-delta">
    Índice:
  </summary>
<ol id="markdown-toc">
  <li><a href="#arquitectura" id="markdown-toc-arquitectura">Arquitectura</a></li>
  <li><a href="#descripción" id="markdown-toc-descripción">Descripción</a></li>
  <li><a href="#aws-s3" id="markdown-toc-aws-s3">AWS S3</a></li>
  <li><a href="#forma-de-despliegue-automática" id="markdown-toc-forma-de-despliegue-automática">Forma de despliegue automática</a>    <ol>
      <li><a href="#generalidades" id="markdown-toc-generalidades">Generalidades</a>        <ol>
          <li><a href="#pasos" id="markdown-toc-pasos">Pasos</a></li>
        </ol>
      </li>
    </ol>
  </li>
</ol>

</details>
      <h1 id="arquitectura">
        
        
          <a href="#arquitectura" class="anchor-heading" aria-labelledby="arquitectura"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Arquitectura
        
        
      </h1>
    

<p><img src="https://cdn.discordapp.com/attachments/955522800918085684/1010224651806462052/unknown.png" alt="My helpful screenshot" width="450" /></p>
      <h1 id="descripción">
        
        
          <a href="#descripción" class="anchor-heading" aria-labelledby="descripción"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Descripción
        
        
      </h1>
    

<ol>
  <li>PDF GENETATOR SERVICE verifica que el PDF de los estuudiantes haya sido creado y ya existe en el repositorio para no volver a crear. En caso de que no exista el PDF, se tendrá que generar el pdf.Para generar los PDFs agrupa la cantidad de peticiones de estudiantes para una descarga masiva de PDF.</li>
  <li>En caso que PDF SERVICE verifique que no existe el PDF, manda el id de estudiante a SQS y lo coloca en cola de ejecución para que luego SQS ejecute el SQS SERVICE (Lambda)  donde le envía cada ID del estudiante y empiece a generar los PDFs.</li>
  <li>Todo PDF generado por SQS SERVICE (Lambda) es enviando a un repositorio de S3.</li>
  <li>El código del proyecto está subido al repositorio <code class="language-plaintext highlighter-rouge">https://git-codecommit.us-east-1.amazonaws.com/v1/repos/queestudiar-queue</code>.</li>
</ol>

<div class="alert alert-danger d-flex" role="alert" style="background: rgb(241, 233, 121); border-radius: 7px;"> 
    <i class="bi bi-exclamation-triangle-fill"></i>
    <div style="margin-left: 0.7em;">
        <strong>NOTA</strong><br />Recordar conceder permisos de consulta a la base de datos mysql a todos los artefactos de microservicios y también al proyeto sqs en la función lambda de AWS
    </div>
</div>

<!-- 1. El proyecto sqs será desplegado mediante serverless. Las instrucciones serverless que funcionaban en queestudiar están en el archivo `serverless.yml` dentro del proyecto. Dentro de ese archivo se debe cambiar las configuraciones por las de USIL, es decir, en general, deben reemplazarse por las credenciales de cada empresa.
1. Se puede [automatizar](https://aws.amazon.com/blogs/devops/building-a-serverless-jenkins-environment-on-aws-fargate/){:target="_blank"} el despliegue del proyecto con la documentación indicada. -->

<!-- ### Paso 1
#### Amazon SQS

Se utilizará el servicio de colas de Amazon SQS y será nombrado `PDF_QUEUE`
La configuración general de la cola debe ser la siguiente:
  ![My helpful screenshot](https://cdn.discordapp.com/attachments/955522800918085684/1039665552102277140/image.png)
  ![My helpful screenshot](https://cdn.discordapp.com/attachments/955522800918085683/1032715515635961927/unknown.png)

### Paso 2

Se debe deplegar el proyecto con severless, para ello:

1. [Creamos](https://qe-docs.herokuapp.com/Queestudiar%20AWS/#downloadpdf){:target="_blank"}  una tabla `DownloadPdf` en DynamoDB.
2. Al haber creado la tabla, vamos a la información de la tabla y tendremos un Nombre de recurso de Amazon (ARN) el cual copiaremos como valor de la variable DYMANO_DOWNLOAD_PDF_TABLE_ARN.
3. También será necesario configurar correctamente la región utilizada por la empresa y ponerla en el documento `serverless.yml`.
4. Copiar el ARN de la cola de SQS:
   ![My helpful screenshot](https://cdn.discordapp.com/attachments/955522800918085684/1039937366258876496/image.png)
5. Pegar el ARN en el documento `.env` como valor de la variable SQS_PDF_QUEUE_ARN.
6. Colocar las siguientes variables de entorno en el documento `.env`:

    | Variables                   | Valor                                 | Descripción |
    | -----------                 | -----------                           | ----------- |
    | AWS_ACCESS_KEY_ID                   | XXXX-XXXX-XXXX | AccessKeyId de AWS |
    | AWS_SECRET_ACCESS_KEY                   | XXXX-XXXX-XXXX | SecretAccessKeyId de AWS |
    | AWS_REGION                   | XXXX-XXXX-XXXX | Region de AWS |
    | DYMANO_DOWNLOAD_PDF_TABLE_ARN                   | XXXX-XXXX-XXXX | ARN de la tabla DownloadPdf |
    | SQS_PDF_QUEUE_ARN                   | XXXX-XXXX-XXXX | ARN de la cola PDF_QUEUE |

    El usuario con esas credenciales debería tener configurado las siguientes políticas:
   ![My helpful screenshot](https://cdn.discordapp.com/attachments/955522800918085684/1040727120537714729/unknown.png)


7. Se debe [instalar node js](https://www.youtube.com/watch?v=ipmhBYqIP44&ab_channel=UskoKruM2010){:target="_blank"} y seguidamente, en el directorio de la aplicción, los siguientes comandos de instalación:
   1. Para instalar las dependencias del proyecto, ejecutar `npm install`.
   2. Para instalar serverless ejecutar `npm install -g serverless`.
   3. Para verificar, ejecutar `serverless --version` y eso debe arrojar la versión de serverless instalada.
   4. Una vez inataladas todas las dependencias, ejecutatr el comando de despliegue: `serverless deploy`
8. Si el despliegue se realizó de forma correcta, se debe tener la siguiente salida en la consola:
   ![My helpful screenshot](https://cdn.discordapp.com/attachments/955522800918085684/1040705088034975834/image.png)

### Paso 3

#### Lambda

Se utilizará el servicio de Funciones de Lambda de AWS. La función será nombrada: `queestudiar-sqs-pdf-prod-handlerSQS`, o similar, eso dependerá del nombre del servicio especificado en `serverless.yml`:
  ![My helpful screenshot](https://cdn.discordapp.com/attachments/955522800918085684/1040023428905836594/image.png)

Esta función se creará de forma automática al hacer el despliegue de la aplicación.

En lambda verificar la función creada automáticamente y, además, deberá tener un desencadenador a la cola de SQS `PDF_QUEUE`:
  ![My helpful screenshot](https://cdn.discordapp.com/attachments/955522800918085684/1039667177025966180/image.png)

La configuración del desencadenador debe tener la siguiente configuración:
  ![My helpful screenshot](https://cdn.discordapp.com/attachments/955522800918085684/1039668395571937430/image.png)
  ![My helpful screenshot](https://cdn.discordapp.com/attachments/955522800918085683/1032731135563792424/unknown.png)

### Paso 4

Dentro de Lambda, en la función creada de forma automática, se deben crear las variables de entorno, damos click en "Editar", y dentro, creamos las variables de entorno:
  ![My helpful screenshot](https://cdn.discordapp.com/attachments/955522800918085684/1039662792011153468/image.png)

Las variables de entorno son las siguientes:

| Variables                   | Valor                                 | Descripción |
| -----------                 | -----------                           | ----------- |
| DB_DIALECT                  | mysql                         | Motor de la base de datos utilizado |
| DB_NAME                     | XXXX-XXXX-XXXX           | Nombre de la base de datos |
| DB_USER_NAME                | XXXX-XXXX-XXXX                              | Nombre de usuario de BD |
| DB_PASSWORD                 | XXXX-XXXX-XXXX                      | Contraseña de la BD |
| DB_HOST                     | XXXX-XXXX-XXXX         | Host de la BD |
| S3_BASE_URL                   | XXXXX-XXXX-XXXX | Url del bucket base de S3. Ejm:<https://queestudiar.s3-us-east-1.amazonaws.com> |
| S3_BUCKET_NAME                   | queestudiar | Nombre del bucket en S3 |
| S3_SUFFIX_NAME                   | pdfs | Nombre del sufijo en S3 |
| PDF_MANAGER_TABLE                   | pdfs | Nombre del almacén de pdfs |
| URL_CHARACTERS                   | XXXX-XXXX-XXXX | Directorio de S3 de la carpeta professionalvalue |
| URL_INTELLIGENT                   | XXXX-XXXX-XXXX | Directorio de S3 de la carpeta intelligence |
| BASE_SERVICE                   | Url de la api principal | Url de la api principal |
| CHROMIUM_LOCATION                   | ./node_modules/puppeteer/.local-chromium/mac-674921/chrome-mac/Chromium.app/Contents/MacOS/Chromium | Ubicación de chromium en node_modules |
| INSTITUTION_ID                   | ba346110-5c59-474a-8504-093d3a7c91e4 | Id de USIL en la bd de queestudiar |
| SCHOOL_WEB_URL                   |<https://school.queestudiar.pe> | Url de la plataforma de colegios |

### Paso 5

Finalmente, la cola de sqs tendrá una URL, eso se colocará como variable de entorno en el proyecto de API-GENERADOR.
  ![My helpful screenshot](https://cdn.discordapp.com/attachments/955522800918085684/1039669151469416459/image.png)
  ![My helpful screenshot](https://cdn.discordapp.com/attachments/955522800918085684/1039939645267525702/unknown.png)
 -->
      <h1 id="aws-s3">
        
        
          <a href="#aws-s3" class="anchor-heading" aria-labelledby="aws-s3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> AWS S3
        
        
      </h1>
    

<p>Este proyecto y otros más necesitan recursos de AWS S3, para ello necesitamos subir esos recursos (imágenes) a un bucket de S3 realizando los siguientes pasos.</p>

<ol>
  <li>Crear un bucket para el proyecto queestudiar con el nombre <code class="language-plaintext highlighter-rouge">queestudiar</code>, si ya lo tiene, contunúe al siguiente paso.</li>
  <li>Descomprimir e importar los siguientes <a href="https://drive.google.com/file/d/1R3ykcBoYh6R2PanPsuDZyfQwSKzndnFQ/view?usp=sharing" target="_blank">archivos</a> dentro del directorio principal del Bucket <code class="language-plaintext highlighter-rouge">queestudiar</code>.
    <ol>
      <li>Descomprimir el archivo <code class="language-plaintext highlighter-rouge">image.tar.gz</code>, descomprimirlo, dentro hay una carpeta <code class="language-plaintext highlighter-rouge">image</code>, subir esa carpeta al bucket <code class="language-plaintext highlighter-rouge">usil-queestudiar</code> de S3.</li>
      <li>Descomprimir el archivo <code class="language-plaintext highlighter-rouge">assets.zip</code>, descomprimirlo, dentro hay una carpeta <code class="language-plaintext highlighter-rouge">assets</code>, subir esa carpeta al bucket <code class="language-plaintext highlighter-rouge">usil-queestudiar</code> de S3.</li>
      <li>Descomprimir el archivo <code class="language-plaintext highlighter-rouge">assets-hbs.tar.gz</code>, descomprimirlo, dentro hay una carpeta <code class="language-plaintext highlighter-rouge">assets-hbs</code>, subir esa carpeta al bucket <code class="language-plaintext highlighter-rouge">usil-queestudiar</code> de S3.</li>
    </ol>
  </li>
  <li>También se debe crear, dentro del bucket de <code class="language-plaintext highlighter-rouge">usil-queestudiar</code>, una carpeta llamada <code class="language-plaintext highlighter-rouge">pdfs</code>, esta carpeta es una variable de entorno.</li>
</ol>

<p>NOTA: De preferencia configurar estos recursos con acceso público ya que otros proyectos también lo requerirán.</p>
      <h1 id="forma-de-despliegue-automática">
        
        
          <a href="#forma-de-despliegue-automática" class="anchor-heading" aria-labelledby="forma-de-despliegue-automática"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Forma de despliegue automática
        
        
      </h1>
    
      <h2 id="generalidades">
        
        
          <a href="#generalidades" class="anchor-heading" aria-labelledby="generalidades"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Generalidades
        
        
      </h2>
    

<p>Esta forma de automatización es automática ya que:</p>

<ol>
  <li>El archivo <code class="language-plaintext highlighter-rouge">serverless.yml</code> creará automáticamente la tabla <code class="language-plaintext highlighter-rouge">DownloadPdf</code> en DynamoDB.</li>
  <li>La cola <code class="language-plaintext highlighter-rouge">pdfQueue</code> se creará de forma automática.</li>
  <li>La función <code class="language-plaintext highlighter-rouge">queestudiar-sqs-pdf-prod-handlerSQS</code> en lambda se creará de forma automática.</li>
</ol>
      <h3 id="pasos">
        
        
          <a href="#pasos" class="anchor-heading" aria-labelledby="pasos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pasos
        
        
      </h3>
    

<ol>
  <li>Hacer pull del código a un entorno local.</li>
  <li>Allí encontrará un archivo <code class="language-plaintext highlighter-rouge">serverless.yml</code>, alí encontrará el sigiuente contenido:</li>
</ol>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql">        <span class="n">service</span><span class="p">:</span> <span class="n">queestudiar</span><span class="o">-</span><span class="n">sqs</span><span class="o">-</span><span class="n">pdf</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="mi">8</span>
        <span class="n">useDotenv</span><span class="p">:</span> <span class="k">true</span>
        <span class="n">provider</span><span class="p">:</span>
          <span class="n">name</span><span class="p">:</span> <span class="n">aws</span>
          <span class="n">runtime</span><span class="p">:</span> <span class="n">nodejs12</span><span class="p">.</span><span class="n">x</span>
          <span class="n">stage</span><span class="p">:</span> <span class="n">prod</span>
          <span class="n">region</span><span class="p">:</span> <span class="err">$</span><span class="p">{</span><span class="n">env</span><span class="p">:</span><span class="n">AWS_REGION</span><span class="p">}</span>
          <span class="n">iam</span><span class="p">:</span>
            <span class="k">role</span><span class="p">:</span>
              <span class="n">statements</span><span class="p">:</span>
                <span class="o">-</span> <span class="n">Effect</span><span class="p">:</span> <span class="n">Allow</span>
                  <span class="n">Action</span><span class="p">:</span>
                    <span class="o">-</span> <span class="n">dynamodb</span><span class="p">:</span><span class="o">*</span>
                    <span class="o">-</span> <span class="n">s3</span><span class="p">:</span><span class="o">*</span>
                  <span class="n">Resource</span><span class="p">:</span>
                    <span class="o">-</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">dynamodb</span><span class="p">:</span><span class="err">$</span><span class="p">{</span><span class="n">env</span><span class="p">:</span><span class="n">AWS_REGION</span><span class="p">}:</span><span class="err">$</span><span class="p">{</span><span class="n">env</span><span class="p">:</span><span class="n">AWS_ACCOUNT_ID</span><span class="p">}:</span><span class="k">table</span><span class="o">/</span><span class="n">DownloadPdf</span>
                    <span class="o">-</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">dynamodb</span><span class="p">:</span><span class="err">$</span><span class="p">{</span><span class="n">env</span><span class="p">:</span><span class="n">AWS_REGION</span><span class="p">}:</span><span class="err">$</span><span class="p">{</span><span class="n">env</span><span class="p">:</span><span class="n">AWS_ACCOUNT_ID</span><span class="p">}:</span><span class="k">table</span><span class="o">/</span><span class="n">DownloadPdf</span><span class="o">/</span><span class="k">index</span><span class="cm">/*
                    - arn:aws:dynamodb:${env:AWS_REGION}:${env:AWS_ACCOUNT_ID}:table/pdfs
                    - arn:aws:dynamodb:${env:AWS_REGION}:${env:AWS_ACCOUNT_ID}:table/pdfs/index/*
                - Effect: Allow
                  Action:
                    - dynamodb:*
                    - s3:*
                  Resource: "arn:aws:dynamodb:${env:AWS_REGION}:${env:AWS_ACCOUNT_ID}:table/DownloadPdf/index/*"
        functions:
          handlerSQS:
            handler: handler.handler
            events:
              - sqs:
                  arn:
                    Fn::GetAtt:
                      - pdfQueue
                      - Arn
        resources:
          Resources:
            pdfQueue:
              Type: AWS::SQS::Queue
              Properties:
                DelaySeconds: 0
                MaximumMessageSize: 1024
                MessageRetentionPeriod: 60
                QueueName: "pdfQueue"
            DownloadPdf:
              Type: "AWS::DynamoDB::Table"
              Properties:
                TableName: DownloadPdf
                AttributeDefinitions:
                  - AttributeName: studentId
                    AttributeType: S
                  - AttributeName: order
                    AttributeType: N
                KeySchema:
                  - AttributeName: studentId
                    KeyType: HASH
                  - AttributeName: order
                    KeyType: RANGE
                ProvisionedThroughput:
                  ReadCapacityUnits: 1
                  WriteCapacityUnits: 1        
      </span></code></pre></figure>

<ol>
  <li>Crear un archivo <code class="language-plaintext highlighter-rouge">.env</code> y dentro crear las siguientes variables de entorno:</li>
</ol>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Variables</th>
      <th>Valor</th>
      <th>Descripción</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>AWS_ACCESS_KEY_ID</td>
      <td>XXXX-XXXX-XXXX</td>
      <td>AccessKeyId de AWS</td>
    </tr>
    <tr>
      <td>AWS_SECRET_ACCESS_KEY</td>
      <td>XXXX-XXXX-XXXX</td>
      <td>SecretAccessKeyId de AWS</td>
    </tr>
    <tr>
      <td>AWS_REGION</td>
      <td>XXXX-XXXX-XXXX</td>
      <td>Region de AWS</td>
    </tr>
    <tr>
      <td>AWS_ACCOUNT_ID</td>
      <td>XXXX-XXXX-XXXX</td>
      <td>ID de la cuenta de AWS:, es un número. Ejm: 923017734157</td>
    </tr>
  </tbody>
</table></div>

<ol>
  <li>Se debe <a href="https://www.youtube.com/watch?v=ipmhBYqIP44&amp;ab_channel=UskoKruM2010" target="_blank">instalar node js</a> y seguidamente, en el directorio de la aplicción, los siguientes comandos de instalación:
    <ol>
      <li>Para instalar las dependencias del proyecto, ejecutar <code class="language-plaintext highlighter-rouge">npm install</code>.</li>
      <li>Para instalar serverless ejecutar <code class="language-plaintext highlighter-rouge">npm install -g serverless</code>.</li>
      <li>Para verificar, ejecutar <code class="language-plaintext highlighter-rouge">serverless --version</code> y eso debe arrojar la versión de serverless instalada.</li>
      <li>Una vez inataladas todas las dependencias, ejecutatr el comando de despliegue: <code class="language-plaintext highlighter-rouge">serverless deploy</code></li>
    </ol>
  </li>
  <li>
    <p>Si el despliegue se realizó de forma correcta, se debe tener la siguiente salida en la consola:
   <img src="https://cdn.discordapp.com/attachments/955522800918085684/1040705088034975834/image.png" alt="My helpful screenshot" /></p>
  </li>
  <li>Luego, verificar que se hayan creado la cola <code class="language-plaintext highlighter-rouge">pdfQueue</code> en SQS, la función <code class="language-plaintext highlighter-rouge">queestudiar-sqs-pdf-prod-handlerSQS</code> en lambda y la tabla <code class="language-plaintext highlighter-rouge">DownloadPdf</code> en dynamoDB.</li>
  <li>
    <p>Se debe verificar que las configuraciones de la cola <code class="language-plaintext highlighter-rouge">pdfQueue</code> sea de la siguiente manera, sino, realizarlo manualmente.
   <img src="https://cdn.discordapp.com/attachments/955522800918085684/1044282705308819556/image.png" alt="My helpful screenshot" /></p>
  </li>
  <li>Se debe verificar que las configuraciones de la función <code class="language-plaintext highlighter-rouge">queestudiar-sqs-pdf-prod-handlerSQS</code> sea de la siguiente manera, sino, realizarlo manualmente.
   <img src="https://cdn.discordapp.com/attachments/955522800918085684/1044283303886323732/image.png" alt="My helpful screenshot" />
   Además, se deben colocar las siguientes variables de entorno en la función de lambda:</li>
</ol>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Variables</th>
      <th>Valor</th>
      <th>Descripción</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>DB_DIALECT</td>
      <td>mysql</td>
      <td>Motor de la base de datos utilizado</td>
    </tr>
    <tr>
      <td>DB_NAME</td>
      <td>XXXX-XXXX-XXXX</td>
      <td>Nombre de la base de datos</td>
    </tr>
    <tr>
      <td>DB_USER_NAME</td>
      <td>XXXX-XXXX-XXXX</td>
      <td>Nombre de usuario de BD</td>
    </tr>
    <tr>
      <td>DB_PASSWORD</td>
      <td>XXXX-XXXX-XXXX</td>
      <td>Contraseña de la BD</td>
    </tr>
    <tr>
      <td>DB_HOST</td>
      <td>XXXX-XXXX-XXXX</td>
      <td>Host de la BD</td>
    </tr>
    <tr>
      <td>S3_BASE_URL</td>
      <td><a href="https://usil-queestudiar.s3.amazonaws.com">https://usil-queestudiar.s3.amazonaws.com</a></td>
      <td>Url del bucket base de S3. Ejm: <a href="https://queestudiar.s3-us-east-1.amazonaws.com">https://queestudiar.s3-us-east-1.amazonaws.com</a></td>
    </tr>
    <tr>
      <td>S3_BUCKET_NAME</td>
      <td>usil-queestudiar</td>
      <td>Nombre del bucket en S3</td>
    </tr>
    <tr>
      <td>S3_SUFFIX_NAME</td>
      <td>pdfs</td>
      <td>Nombre del sufijo en S3</td>
    </tr>
    <tr>
      <td>PDF_MANAGER_TABLE</td>
      <td>DownloadPdf</td>
      <td>Nombre del almacén de pdfs</td>
    </tr>
    <tr>
      <td>URL_CHARACTERS</td>
      <td><a href="https://usil-queestudiar.s3.amazonaws.com/assets/images/vocation/professionalvalue/">https://usil-queestudiar.s3.amazonaws.com/assets/images/vocation/professionalvalue/</a></td>
      <td>Directorio de S3 de la carpeta professionalvalue</td>
    </tr>
    <tr>
      <td>URL_INTELLIGENT</td>
      <td><a href="https://usil-queestudiar.s3.amazonaws.com/assets/images/vocation/intelligence/">https://usil-queestudiar.s3.amazonaws.com/assets/images/vocation/intelligence/</a></td>
      <td>Directorio de S3 de la carpeta intelligence</td>
    </tr>
    <tr>
      <td>BASE_SERVICE</td>
      <td><a href="http://queestudiar-api-test-924cbc13d3c4341b.us-east-1.elasticbeanstalk.com">http://queestudiar-api-test-924cbc13d3c4341b.us-east-1.elasticbeanstalk.com</a></td>
      <td>Url de la api principal (sin ‘/’ final)</td>
    </tr>
    <tr>
      <td>CHROMIUM_LOCATION</td>
      <td>./node_modules/puppeteer/.local-chromium/mac-674921/chrome-mac/Chromium.app/Contents/MacOS/Chromium</td>
      <td>Ubicación de chromium en node_modules</td>
    </tr>
    <tr>
      <td>INSTITUTION_ID</td>
      <td>ba346110-5c59-474a-8504-093d3a7c91e4</td>
      <td>Id de USIL en la bd de queestudiar</td>
    </tr>
    <tr>
      <td>SCHOOL_WEB_URL</td>
      <td><a href="http://queestudiar-colegio-web-test-924cbc13d3c4341b.us-east-1.elasticbeanstalk.com">http://queestudiar-colegio-web-test-924cbc13d3c4341b.us-east-1.elasticbeanstalk.com</a></td>
      <td>Url de la plataforma de colegios</td>
    </tr>
  </tbody>
</table></div>

<ol>
  <li>Se debe verificar que las configuraciones de la tabla <code class="language-plaintext highlighter-rouge">DownloadPdf</code> sea de la siguiente manera, sino, realizarlo manualmente.
   <img src="https://cdn.discordapp.com/attachments/955522800918085684/1044284753811079238/image.png" alt="My helpful screenshot" /></li>
  <li>Finalmente, la cola de sqs tendrá una URL, eso se colocará como variable de entorno en el proyecto de API-GENERADOR.
   <img src="https://cdn.discordapp.com/attachments/955522800918085684/1039669151469416459/image.png" alt="My helpful screenshot" />
   <img src="https://cdn.discordapp.com/attachments/955522800918085684/1039939645267525702/unknown.png" alt="My helpful screenshot" /></li>
</ol>

        

        

        
        

      </div>
    </div>

    
      

      <div class="search-overlay"></div>
    
  </div>
</body>
</html>

